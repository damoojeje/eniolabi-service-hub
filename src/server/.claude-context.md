# Server Directory Context

## Purpose
tRPC server-side code including routers, middleware, and database operations.

## Structure
```
server/
├── trpc.ts           # tRPC server setup, middleware, procedures
└── routers/
    ├── services.ts   # Service monitoring operations
    ├── users.ts      # User management operations
    └── notifications.ts # Email notification operations
```

## tRPC Setup
- **Context**: Session, database, Redis connections
- **Middleware**: Authentication, role-based access control
- **Procedures**: 
  - `publicProcedure` - Open access
  - `protectedProcedure` - Requires authentication
  - `adminProcedure` - Requires ADMIN role
  - `powerUserProcedure` - Requires POWER_USER+ role

## Routers

### Services Router (`services.ts`)
- `getAll` - Fetch all services with current status
- `getById` - Get service details with status history
- `getStats` - Service statistics (online/offline counts)
- `checkHealth` - Manual health check for single service
- `checkAllHealth` - Bulk health check for all services
- `create/update/delete` - Service management (admin only)

### Users Router (`users.ts`)
- `getAll` - List all users (admin only)
- `getById` - Get user details
- `getStats` - User statistics
- `create/update/delete` - User management (admin only)
- `resetPassword` - Password reset (admin only)
- `changePassword` - Self password change

### Notifications Router (`notifications.ts`)
- `getPreferences` - Get user notification settings
- `updatePreferences` - Update notification preferences
- `sendTestNotification` - Send test email

## Security
- Role-based access control throughout
- bcrypt password hashing (rounds: 12)
- Session-based authentication
- SQL injection protection via Prisma
- Input validation with Zod schemas